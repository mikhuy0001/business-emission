function getCookie(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var i=a[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}let canvas=document.getElementById("preview"),context=canvas.getContext("2d"),video=document.getElementById("video");canvas.width=600,canvas.height=450,context.width=canvas.width,context.height=canvas.height;let key=document.getElementById("key"),emissionKey=document.getElementById("emissionKey"),eventStream=getCookie("eventStream"),viewers=document.getElementById("viewers"),socket=io({query:{key:key.innerHTML,emissionKey:emissionKey.innerHTML,eventStream:eventStream}}),socketViewers=io({query:{key:key.innerHTML,emissionKey:emissionKey.innerHTML}});socketViewers.on("viewers",function(e){viewers.innerText=e});let emissionEvent=document.getElementById("emissionEvent");emissionEvent.value=eventStream;let camerasAccess=document.getElementById("camerasAccess");camerasAccess.addEventListener("click",getCameras);async function getCameras(){try{video.srcObject=await navigator.mediaDevices.getDisplayMedia()}catch(e){}}function logger(e){}function loadCam(e){video.srcObject=e,logger("Webcam cargada correctamente")}function loadFail(){logger("Webcam no conectada, revise su cÃ¡mara.")}function viewVideo(e,t){t.drawImage(e,0,0,t.width,t.height),socket.emit(eventStream,canvas.toDataURL("image/webp"))}$(function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msgGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},loadCam,loadFail);let e;$("#start").click(function(){e=setInterval(function(){viewVideo(video,context)},175),recordedChunks=[],initMediaRecorder()}),stop=document.getElementById("stop"),$("#stop").click(function(){mediaRecorder.stop(),clearInterval(e)})});var recordedChunks=[];function initMediaRecorder(){var e=canvas.captureStream(70);mediaRecorder=new MediaRecorder(e,{mimeType:"video/webm; codecs=vp9"}),mediaRecorder.ondataavailable=handleDataAvailable,mediaRecorder.start()}function handleDataAvailable(e){0<e.data.size&&(recordedChunks.push(e.data),download())}function download(){var e=new Blob(recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),e=document.createElement("a");document.body.appendChild(e),e.style="display: none",e.href=t,e.download="test.webm",e.click(),window.URL.revokeObjectURL(t)}