const qs=require("querystring"),{login}=require("../controllers/login");async function pSignInBusinessServer(n,o){var r="";n.on("data",function(e){1e6<(r+=e).length&&n.connection.destroy()}),n.on("end",async function(){var e=qs.parse(r),{port:n}=require("../app"),n=await login(e.key,e.user,e.password,n);n.error?o.render("login",{error:n.error}):(o.cookie("userType","business",{maxAge:72e6,httpOnly:!0}),o.cookie("token",n.token,{maxAge:72e6,httpOnly:!0}),o.cookie("sessionID",n.session,{maxAge:72e6,httpOnly:!0}),o.cookie("eventStream",n.eventStream,{maxAge:72e6,httpOnly:!1}),o.cookie("idEmission",n.idEmission,{maxAge:72e6,httpOnly:!1}),o.redirect(`https://ayacuchoseguro.herokuapp.com/login/${n.session}/${n.token}`))})}module.exports.pSignInBusinessServer=pSignInBusinessServer;