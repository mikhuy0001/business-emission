let{server}=require("../app"),io=require("socket.io")(server);module.exports.io=io;let{socketBusiness}=require("./socketBusiness"),{socketViewers}=require("./socketViewers"),{socketClient}=require("./socketClient");require("./middleware");let viewers=[0],client_usedCode=[];io.on("connection",async function(s){var{emissionKey:e,eventStream:i,visualizationCode:o}=s.handshake.query;if("businessEmission"==e)i?socketBusiness(s,i,client_usedCode,io):socketViewers(s);else{let i=s.id;socketClient(s,o,io,client_usedCode,i,viewers),s.on("disconnect",()=>{viewers[0]--;var e=client_usedCode.findIndex(e=>e.clientID==i);client_usedCode.splice(e,1),s.broadcast.emit("viewers",viewers[0])})}});